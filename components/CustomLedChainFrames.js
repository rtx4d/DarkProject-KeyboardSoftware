"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var BoxSelectionArea_1=require("./BoxSelectionArea"),LedChainFramesManager=function(){function e(e){this.LedChainFrames=[],this.AllBlockColor=[],this.currentChooseIndex=0,this.showRangeType=0,this.showAddColorUI=!1,this.onEditName="",this.maxkaycapNumber=0,this.BSApage7=new BoxSelectionArea_1.BoxSelectionArea("RGBColorBlockP7"),this.performingCustomLED=!1,this.maxkaycapNumber=e;for(var t=0;t<1;t++)this.LedChainFrames.push(new CustomLedChainFrames("Default",this.maxkaycapNumber));for(var r=0;r<this.maxkaycapNumber;r++)this.AllBlockColor.push({color:"yellow",border:!1})}return e.prototype.getIndexClassName=function(e){if(this.LedChainFrames.length>0)return this.LedChainFrames[e]},e.prototype.getLedProjectKeys=function(e){return void 0===e&&(e=""),"PC"==e?this.LedChainFrames.map(function(e){return e.projectCode}):"PN"==e?this.LedChainFrames.map(function(e){return e.projectName}):void 0},e.prototype.getLedClassName=function(e){console.log("getLedClassName尋找",e,"來源",this.LedChainFrames);for(var t=0;t<this.LedChainFrames.length;t++)if(this.LedChainFrames[t].projectCode==e)return this.LedChainFrames[t].projectName;return"沒有找到目標"},e.prototype.addItem=function(e){void 0===e&&(e="");var t=this.createNotRepeatClassName(e);this.LedChainFrames.push(new CustomLedChainFrames(t,this.maxkaycapNumber))},e.prototype.createNotRepeatClassName=function(e){for(var t=!0,r=0,o=e;t;)r>0&&(o=e+r),this.checkClassNameIsRepeat(o)?r+=1:t=!1;return o},e.prototype.checkClassNameIsRepeat=function(e){for(var t=0;t<this.LedChainFrames.length;t++){var r=this.LedChainFrames[t].projectName;if(e==r)return!0}return!1},e.prototype.projectSelect=function(e){return this.currentChooseIndex=e,this.updeteEditName(),"Finish"},e.prototype.updeteEditName=function(){this.onEditName=this.getClass().projectName,this.performingCustomLED=!0},e.prototype.getClass=function(){if(this.LedChainFrames.length>0)return this.LedChainFrames[this.currentChooseIndex]},e.prototype.isFirstPosition=function(){return!(this.currentChooseIndex-1>=0)},e.prototype.delete_item=function(){if(this.currentChooseIndex>0){var e=this.currentChooseIndex;this.currentChooseIndex-=1,this.LedChainFrames.splice(e,1)}else 0==this.currentChooseIndex&&this.LedChainFrames.splice(this.currentChooseIndex,1)},e.prototype.check_length=function(e){return void 0===e&&(e=""),"F"==e?0!=this.getClass().matrix_frames.length:"C"==e?0!=this.getClass().matrix_ColorMode.length:void 0},e.prototype.ImportClassCreateData=function(e){e=JSON.parse(JSON.stringify(e));for(var t=new CustomLedChainFrames("沒有"),r=Object.keys(t),o=0;o<r.length;o++)"BSApage7"!=r[o]&&(t[r[o]]=e[r[o]]);t.projectCode=(new Date).getTime(),console.log("ImportClassCreateData_PushData",t,typeof e),this.LedChainFrames.push(t)},e.prototype.ReadClassCreateData=function(e){e=JSON.parse(JSON.stringify(e));for(var t=new CustomLedChainFrames("沒有"),r=Object.keys(t),o=0;o<r.length;o++)t[r[o]]=e[r[o]];console.log("ImportClassCreateData_PushData",t,typeof e),this.LedChainFrames.push(t)},e.prototype.frame_item_click=function(e){this.getClass().currentFramesIndex=e,this.showRangeType=0,this.update_frame_range(),this.performingCustomLED=!1},e.prototype.frame_item_Auto_Switch=function(){this.showRangeType=0,this.update_frame_range()},e.prototype.update_frame_range=function(){if(this.getClass().hasFrames()){console.log("update_frame_rangeEnter");var e=this.getClass().getTarget("F").frame_selection_range;this.allBlockColorUpdate(e,"#FFFFFF","#0000")}},e.prototype.update_color_range=function(){if(this.getClass().hasColorMode()){this.getClass().checkColorpickerAdjustable();var e=this.getClass().getTargetColorMode().frame_selection_range,t=this.getClass().getTargetColorMode().color;this.allBlockColorUpdate(e,t,"#0000")}},e.prototype.allBlockColorUpdate=function(e,t,r){for(var o=0;o<e.length;o++){var s=e[o];1==s?this.AllBlockColor[o].color=t:this.AllBlockColor[o].color=r}},e.prototype.color_item_click=function(e){this.getClass().currentModeIndex=e,this.showRangeType=1,this.update_color_range(),this.performingCustomLED=!1},e.prototype.color_Auto_Switch=function(){this.getClass().hasColorMode()&&(this.showRangeType=1,this.update_color_range())},e.prototype.refreshRange=function(){0==this.showRangeType&&this.getClass().hasFrames()?this.update_frame_range():1==this.showRangeType&&this.getClass().hasColorMode()&&this.update_color_range()},e.prototype.setNowCustomModeSingleRange=function(e){0==this.showRangeType&&this.getClass().hasFrames()?(this.getClass().setNowCustomModeSingleRange(e,this.showRangeType),this.update_frame_range()):1==this.showRangeType&&this.getClass().hasColorMode()&&(this.getClass().setNowCustomModeSingleRange(e,this.showRangeType),this.update_color_range())},e.prototype.checkisAllTrueChangeArray=function(){var e=this.BSApage7.selectedEls;if(e.length<=0)return console.log("沒有選擇範圍",e,"AllBlockColor"+this.AllBlockColor),"Fail";if(0==this.showRangeType){var t=this.getClass().getTarget("F").frame_selection_range,r=this.BSApage7.checkArrayisAllTrueP7(t);if(r){for(var o=0;o<e.length;o++)console.log("checkisAllTrueChangeArray_isAllTrue","index",o),this.AllBlockColor[e[o]].color="#0000";this.getClass().set_frame_selection_range(e,!r)}else{for(var o=0;o<e.length;o++)console.log("checkisAllTrueChangeArray_NAllTrue","index",o),this.AllBlockColor[e[o]].color="#FFFFFF";this.getClass().set_frame_selection_range(e,!0)}}else if(1==this.showRangeType){var t=this.getClass().getTarget("").frame_selection_range,r=this.BSApage7.checkArrayisAllTrueP7(t),e=this.BSApage7.selectedEls;r?(this.getClass().set_color_selection_range(e,!r),this.update_color_range()):(this.getClass().set_color_selection_range(e,!0),this.update_color_range())}return this.BSApage7.mouseOn=!1,"Finish"},e}();exports.LedChainFramesManager=LedChainFramesManager;var CustomLedChainFrames=function(){function e(e,t){void 0===e&&(e="預設配置"),void 0===t&&(t=0),this.modeNameTable=["Static","Cycle","Breathing","Rainbow"],this.matrix_ColorMode=[],this.matrix_frames=[],this.currentFramesIndex=0,this.currentModeIndex=0,this.selectionMaxRange=0,this.canSeeColorpicker=0,this.selectionMaxRange=t,this.projectName=e,this.projectCode=(new Date).getTime()+e}return e.prototype.hasFile=function(){return this.matrix_frames.length>0||(this.matrix_ColorMode.length>0||void 0)},e.prototype.hasFrames=function(){return this.matrix_frames.length>0},e.prototype.hasColorMode=function(){return this.matrix_ColorMode.length>0},e.prototype.checkColorpickerAdjustable=function(){this.canSeeColorpicker=this.getTarget().adjustable[0],console.log("checkColorpickerAdjustable",this.canSeeColorpicker)},e.prototype.getTargetColorMode=function(){if(this.matrix_ColorMode.length>0)return this.matrix_ColorMode[this.currentModeIndex]},e.prototype.checkColorParameter=function(e,t){this.matrix_ColorMode.forEach(function(r){console.log("checkColorParameter",r.speed),r.speed=r.speed.toString().replace(/[^\d]/g,""),r.speed<e?r.speed=e:" ",r.speed>t?r.speed=t:" ",r.speed2=r.speed2.toString().replace(/[^\d]/g,""),r.speed2<e?r.speed2=e:" ",r.speed2>t?r.speed2=t:" "})},e.prototype.checkFrameParameter=function(e,t){this.matrix_frames.forEach(function(r){r.frame_time=r.frame_time.toString().replace(/[^\d]/g,""),r.frame_time<e?r.frame_time=e:" ",r.frame_time>t?r.frame_time=t:" "})},e.prototype.framesOrder=function(e){switch(void 0===e&&(e=""),e){case"Add":if(this.matrix_frames.length>19)return;this.matrix_frames.push({name:"frame"+this.matrix_frames.length,frame_time:"1",frame_selection_range:this.createArr()}),console.log("framesOrderAdd",this.matrix_frames);break;case"Delete":if(0==this.matrix_frames.length)return;if(this.currentFramesIndex>0){var t=this.currentFramesIndex;this.currentFramesIndex-=1,this.matrix_frames.splice(t,1)}else 0==this.currentFramesIndex&&this.matrix_frames.splice(this.currentFramesIndex,1);break;case"moveUp":if(0==this.matrix_frames.length)return;var r=this.currentFramesIndex;if(r>0){var o=$.extend(!0,{},this.getTarget("F"));this.matrix_frames[r]=this.matrix_frames[r-1],this.matrix_frames[r-1]=o,this.currentFramesIndex-=1}break;case"moveDown":if(0==this.matrix_frames.length)return;var r=this.currentFramesIndex;if(r>=this.matrix_frames.length-1)return;var s=$.extend(!0,{},this.getTarget("F"));this.matrix_frames[r]=this.matrix_frames[r+1],this.matrix_frames[r+1]=s,this.currentFramesIndex+=1;break;case"clone":if(0==this.matrix_frames.length)return;if(this.matrix_frames.length>19)return;var a=$.extend(!0,{},this.getTarget("F"));a.name=this.getTarget("F").name,this.matrix_frames.push(a)}},e.prototype.colorModeOrder=function(e,t){switch(void 0===e&&(e=""),void 0===t&&(t=0),e){case"Add":if(this.matrix_ColorMode.length>19)return;this.matrix_ColorMode.push({color:"#FFFFFF",border:!1,colorMode:t,modeName:this.modeNameTable[t],speed:1,speed2:1,frame_selection_range:this.createArr(),codeName:(new Date).getTime(),adjustable:this.getAdjustmentArr(t)});break;case"Delete":if(0==this.matrix_ColorMode.length)return;if(this.currentModeIndex>0){var r=this.currentModeIndex;this.currentModeIndex-=1,this.matrix_ColorMode.splice(r,1)}else 0==this.currentModeIndex&&this.matrix_ColorMode.splice(this.currentModeIndex,1);break;case"moveUp":if(0==this.matrix_ColorMode.length)return;var o=this.currentModeIndex;if(o>0){var s=$.extend(!0,{},this.getTarget());this.matrix_ColorMode[o]=this.matrix_ColorMode[o-1],this.matrix_ColorMode[o-1]=s,this.currentModeIndex-=1}break;case"moveDown":if(0==this.matrix_ColorMode.length)return;var o=this.currentModeIndex;if(o>=this.matrix_ColorMode.length-1)return;var a=$.extend(!0,{},this.getTarget());this.matrix_ColorMode[o]=this.matrix_ColorMode[o+1],this.matrix_ColorMode[o+1]=a,this.currentModeIndex+=1;break;case"clone":if(0==this.matrix_ColorMode.length)return;if(this.matrix_ColorMode.length>19)return;var i=$.extend(!0,{},this.getTarget());i.name=this.getTarget().name,this.matrix_ColorMode.push(i)}},e.prototype.getAdjustmentArr=function(e){switch(e){case 0:return[1,!1,!1,!1];case 1:return[2,!0,!1,!1];case 2:return[1,!1,!0,!0];case 3:return[0,!1,!0,!0]}},e.prototype.setNowCustomModeSingleRange=function(e,t){if(0==t){if(this.matrix_frames.length>0){var r=this.matrix_frames[this.currentFramesIndex].frame_selection_range[e];console.log("setNowCustomModeSingleRange=","targetBool"+r),this.matrix_frames[this.currentFramesIndex].frame_selection_range[e]=!r}}else if(1==t&&this.matrix_ColorMode.length>0){var r=this.matrix_ColorMode[this.currentModeIndex].frame_selection_range[e];this.matrix_ColorMode[this.currentModeIndex].frame_selection_range[e]=!r}},e.prototype.set_frame_selection_range=function(e,t){if(void 0===e&&(e=[]),void 0===t&&(t=!1),this.matrix_frames.length>0){console.log("Enter_set_frame_selection_range",e,"SetBoolTo="+t);for(var r=0;r<e.length;r++)this.matrix_frames[this.currentFramesIndex].frame_selection_range[e[r]]=t}},e.prototype.set_color_selection_range=function(e,t){if(void 0===e&&(e=[]),void 0===t&&(t=!1),console.log("Enter_set_frame_selection_range",e,"SetBoolTo="+t),this.matrix_ColorMode.length>0)for(var r=0;r<e.length;r++)this.matrix_ColorMode[this.currentModeIndex].frame_selection_range[e[r]]=t},e.prototype.getTarget=function(e){if(void 0===e&&(e=""),"F"==e){if(this.matrix_frames.length>0){this.matrix_frames[this.currentFramesIndex];return this.matrix_frames[this.currentFramesIndex]}}else if(this.matrix_ColorMode.length>0)return this.matrix_ColorMode[this.currentModeIndex]},e.prototype.setCurrentColor=function(e){void 0===e&&(e=""),this.matrix_ColorMode.length>0&&(this.getTarget().color=e)},e.prototype.createArr=function(){for(var e=new Array,t=0;t<this.selectionMaxRange;t++)e.push(!1);return console.log("LCFMcreateArr"+e),e},e.prototype.ImportCustomLedData=function(e){for(var t=Object.keys(this),r=0;r<t.length;r++)""!=t[r]&&(this[t[r]]=e[t[r]])},e.prototype.setDefault=function(){},e}();exports.CustomLedChainFrames=CustomLedChainFrames;