"use strict";var __decorate=this&&this.__decorate||function(e,t,o,r){var a,n=arguments.length,s=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,r);else for(var i=e.length-1;i>=0;i--)(a=e[i])&&(s=(n<3?a(s):n>3?a(t,o,s):a(t,o))||s);return n>3&&s&&Object.defineProperty(t,o,s),s},__metadata=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(exports,"__esModule",{value:!0});var core_1=require("@angular/core"),protocol_service_1=require("../services/service/protocol.service"),ng2_translate_1=require("ng2-translate"),index_1=require("../services/libs/electron/index"),icpEventService_service_1=require("../services/service/icpEventService.service"),material_1=require("@angular/material"),index_2=require("../services/device/index"),router_1=require("@angular/router"),ipcRenderer=System._nodeRequire("electron").ipcRenderer,iro=System._nodeRequire("./js/iro.js"),evtVar=System._nodeRequire("./backend/others/EventVariable"),funcVar=System._nodeRequire("./backend/others/FunctionVariable"),env=System._nodeRequire("./backend/others/env"),remote=System._nodeRequire("electron").remote,dialog=remote.dialog,SpecEffects=System._nodeRequire("./backend/protocol/SpecEffects"),ColorVar_1=require("./ColorVar"),APModeModule_1=require("./APModeModule"),MacroModule_1=require("./MacroModule"),CustomLedChainFrames_1=require("./CustomLedChainFrames"),KeyBoardManager_1=require("./KeyBoardManager"),SharesFunction_1=require("./SharesFunction"),AssociateData_1=require("./AssociateData"),EffectCenter_1=require("./EffectCenter"),RecordScript_1=require("./RecordScript"),KeyShortcut_1=require("./KeyShortcut"),AlertDevice_1=require("./AlertDevice"),EventManager_1=require("./EventManager"),ImgPath_1=require("./ImgPath"),i18n_1=require("./i18n"),FirewareManager_1=require("./FirewareManager"),AppComponent=function(){function e(e,t,o,r,a,n,s,i,c,l,d){var g=this;this.protocol=e,this.translate=t,this.emitService=o,this.icpEventService=r,this.dialog=a,this.db=n,this.getAppService=s,this.deviceObj=i,this.router=c,this.elementRef=l,this.changeDetectorRef=d,this.RGBMode=new APModeModule_1.Wave(87),this.ImgPath=new ImgPath_1.ImgPath,this.MacroManager=new MacroModule_1.MacroManager,this.KeyBoardManager=new KeyBoardManager_1.KeyBoardManager(87),this.KeyBoardStyle=new KeyBoardManager_1.KeyBoardStyle,this.Led=new APModeModule_1.Led(87),this.LedColor=new ColorVar_1.CurrentColor("LedColor"),this.customLedColor=new ColorVar_1.CurrentColor("customLedColor"),this.LCFM=new CustomLedChainFrames_1.LedChainFramesManager(87),this.AssociateManager=new AssociateData_1.AssociateManager,this.EffectCenter=new EffectCenter_1.EffectCenter,this.KeyShortcut=new KeyShortcut_1.KeyShortcut,this.AlertDevice=new AlertDevice_1.AlertDevice,this.EM=new EventManager_1.EventManager,this.RS=new RecordScript_1.RecordScript,this.i18nManager=new i18n_1.i18nManager,this.FWManager=new FirewareManager_1.FirewareManager,this.SharesFunction=new SharesFunction_1.SharesFunction,this.KBSPBUI=[!1,!1,!1,!1,!1,!1,!1,!1],this.switchEffectUI=!1,this.conslogtestText="",this.fromicp=[!1,!1,!1],this.deivceplug=!1,this.ShowPrompt=!1,this.onRecord=!1,this.pageIconSet=[!0,!0,!0,!0],this.recordCustomLedindex=0,this.currentLanguages=["EN","CH"],this.on_AdvancedFive=!1,this.ShowAdvancedList=!1,this.alertMessageBool=!1,this.onSystemSetting=!1,this.DeivceStatus="DeviceDetect",this.CurrentPageIndex=-5,this.KeyBoardSetPageBtn=1,this.onEqipBtn=!1,this.onAppImportExport=!1,this.MultipleDeviceConnectStatus=[],this.P_S_OSetting=!1,this.onLoading=!1,this.hasMultipleDevice=!1,this.macroContentInEdit=!1,this.BatteryStep=0,this.pageMouseoverStatus=[0,0,0,0],this.modeNameTable=["Static","Cycle","Breathing","Rainbow"],this.iskeydown=0,this.isMouseOn=0,this.eventRecordkey=5555,this.startTime=(new Date).getTime(),this.RGBEffectCenterEventArr=[],this.RGBC_B_SArr=[],this.BoxSelectFnArrP1=[],this.BoxSelectFnArrP7=[],this.colorPickerFnArrP1=[],this.colorPickerFnArrP7=[];var h=[];h.push("Open DarkProject-KD3"),h.push("Quit DarkProject-KD3"),ipcRenderer.send("Open",h),r.event(),this.subscription=this.emitService.EmitObservable.subscribe(function(e){g.fromicp=e;if(g.fromicp.Func===evtVar.EventTypes.SendSyncLED){if(1==g.CurrentPageIndex&&0==g.Led.BSApage1.EventCanBoxSelect)for(var t=0;t<g.Led.AllBlockColor.length;t++)g.Led.AllBlockColor[t].color=g.fromicp.Param.Data[t]}else if(g.fromicp.Func===evtVar.EventTypes.SendCustomLED){if(7==g.CurrentPageIndex&&g.LCFM.performingCustomLED)for(var t=0;t<g.LCFM.AllBlockColor.length;t++)g.LCFM.AllBlockColor[t].color=g.fromicp.Param.Data[t]}else if(g.fromicp.Func===evtVar.EventTypes.SwitchProfile){var o=g.fromicp.Param.Profile;void 0!=o&&(console.log("currentChooseKeyBoard Profile:",o),g.KeyBoardManager.currentChooseKeyBoard=o,g.KeyBoardManager.getTarget().checkKeyAssignHasData("from_ServerSwitchProfile"))}else if(g.fromicp.Func===evtVar.EventTypes.RefreshDevice)console.log("this.fromicp.Param:",g.fromicp.Param),g.MultipleDeviceConnectStatus=g.fromicp.Param,0==g.fromicp.Param[0]&&(g.BatteryStep=0);else if(g.fromicp.Func===evtVar.EventTypes.SendBatteryStats)console.log("BatteryStats:",g.fromicp.Param),g.BatteryStep=g.fromicp.Param;else if(g.fromicp.Func===evtVar.EventTypes.SendNotification){console.log("SendNotification:",JSON.parse(JSON.stringify(g.fromicp.Param)));var r=[];g.FWManager.hasUpdate=g.fromicp.Param.FWUpdate,g.FWManager.version=g.fromicp.Param.OldVersion;var a={Type:funcVar.FuncType.System,Func:funcVar.FuncName.ReadAllReleasenote,Param:0};g.protocol.RunSetFunction(a).then(function(e){console.log("ReadAllReleasenote data:",JSON.parse(JSON.stringify(e))),r=JSON.parse(JSON.stringify(e)),g.FWManager.updateContent=r})}})}return e.prototype.getPageTitleText=function(){switch(this.CurrentPageIndex){case 1:return this.i18nManager.getTarget().Share.LIGHTINGSETTING;case 2:return this.i18nManager.getTarget().Share.KEYBOARDSETTINGS;case 3:return this.i18nManager.getTarget().Share.MACROSETTINGS;case 4:return this.i18nManager.getTarget().Share.RELATEDPROGRAM;case 7:return this.i18nManager.getTarget().Share.LIGHTINGSETTING}},e.prototype.ReturnAdvancedBtnImage=function(e){if(void 0===e&&(e=""),7==this.CurrentPageIndex&&!this.onEqipBtn)return"url('./image/Share/On/AdvanceEdit.png')";switch(e){case"mouseenter":return"url('./image/Share/mouseover/AdvanceEdit.png')";case"mousedown":return"url('./image/Share/On/AdvanceEdit.png')";case"mouseleave":return"url('./image/Share/Off/AdvanceEdit.png')";case"":return"url('./image/Share/Off/AdvanceEdit.png')"}},e.prototype.ReturnBackBtnImage=function(e){if(void 0===e&&(e=""),this.i18nManager.recovery[0])return this.ImgPath.SystemDefault[1];switch(e){case"mouseenter":return this.ImgPath.SystemDefault[2];case"mouseup":return this.ImgPath.SystemDefault[0];case"mouseleave":return this.ImgPath.SystemDefault[0];case"":return this.ImgPath.SystemDefault[0]}},e.prototype.ReturnEqipBtnImage=function(e){if(void 0===e&&(e=""),this.onEqipBtn)return"url('./image/Share/On/AddEqip.png')";switch(e){case"mouseenter":return"url('./image/Share/mouseover/AddEqip.png')";case"mousedown":case"mouseup":this.onEqipBtn=!0;break;case"mouseleave":return"url('./image/Share/Off/AddEqip.png')";case"":return"url('./image/Share/Off/AddEqip.png')"}},e.prototype.customConsolelog=function(e,t){void 0===e&&(e=""),console.log(e,t)},e.prototype.LaunchFWUpdateToServer=function(){var e=this;console.log("LaunchFWUpdateToServer:");var t={iDevice:0},o={Type:funcVar.FuncType.Device,Func:funcVar.FuncName.LaunchFWUpdate,Param:t};this.onLoading=!0,this.protocol.RunSetFunction(o).then(function(t){e.onLoading=!1;var o=t.Text;if("QuitApp"==o){console.log("CloseApp");var r={Type:funcVar.FuncType.System,Func:funcVar.FuncName.QuitApp};e.protocol.RunSetFunction(r)}else e.FWManager.hasUpdate=t.FWUpdate,e.FWManager.version=t.NewVersion,console.log("LaunchFWUpdateToServer Done",t)})},e.prototype.boxSelectionStart=function(){this.Led.BSApage1.EventCanBoxSelect=!this.Led.BSApage1.EventCanBoxSelect,this.EffectCenter.selectEffectCenter=!1,this.Led.BSApage1.EventCanBoxSelect&&(this.Led.updateframe_selection_range(),this.Led.showSelectionRange())},e.prototype.boxEffectStart=function(){this.changeDetectorRef.detectChanges(),this.EffectCenter.selectEffectCenter=!this.EffectCenter.selectEffectCenter,this.Led.BSApage1.EventCanBoxSelect=!1},e.prototype.changeWinSystemTaskBar=function(e){var t={Type:funcVar.FuncType.System,Func:funcVar.FuncName.ChangeWindowSize,Param:e},o={dotype:e,obj2:t};console.log("changeWinSystemTaskBar:",o),this.protocol.RunSetFunction(t).then(function(e){env.log("Hdpage","quit","finished")})},e.prototype.eventRecordingKeep=function(e){e!=this.eventRecordkey&&(this.iskeydown+=1,this.eventRecordkey=e,this.addMacroRadioOptions(e,1),this.startTime=(new Date).getTime(),console.log("eventRecordingKeep_keyCode=",e,"iskeydown=",this.iskeydown))},e.prototype.eventRecordingbreak=function(e){this.iskeydown-=1,console.log("eventRecordingbreak_keyCode=",e,"iskeydown=",this.iskeydown),this.addMacroRadioOptions(e,0),this.startTime=(new Date).getTime(),0==this.iskeydown&&(this.eventRecordkey=5555)},e.prototype.addMacroRadioOptions=function(e,t){if(this.MacroManager.tempMacroContent.Data.length>=80)return this.iskeydown=0,void(this.onRecord=!1);switch(this.MacroManager.radioOptions){case 0:var o=(new Date).getTime()-this.startTime;this.MacroManager.tempMacroContent.createRow(o,t,e);break;case 1:this.MacroManager.tempMacroContent.createRow(5,t,e);break;case 2:var r=document.getElementById("customMs");this.MacroManager.tempMacroContent.createRow(parseInt(r.value),t,e)}},e.prototype.macro_assign_click=function(e){this.MacroManager.getClass().currentChooseMacro=e},e.prototype.onRecordClick=function(){this.onRecord?(this.iskeydown=0,this.onRecord=!1,this.setDBDataToServer("MacroManager")):(this.MacroManager.tempMacroContent.clear(),this.onRecord=!0,this.startTime=(new Date).getTime())},e.prototype.LedColorhueChange=function(){this.LedColor.HSL_RGB_HexSet(),this.LedColor.setGradientBGcolor(),this.updateColorBlockP1(),this.showCustomTestDataWindows(this.LedColor)},e.prototype.customColorParameterChange=function(e,t,o){void 0===t&&(t=""),console.log("customColorParameterChange進入",e),this.LCFM.getClass().checkColorParameter(1,255),this.setDBDataToServer("CustomData")},e.prototype.customColorHueChange=function(e){console.log("customColorHueChange進入",e),this.customLedColor.HSL_RGB_HexSet(),this.customLedColor.setGradientBGcolor(),this.updateColorBlockP7(),this.setDBDataToServer("CustomData")},e.prototype.customLedFrameChange=function(e){this.LCFM.getClass().checkFrameParameter(1,655),this.setDBDataToServer("CustomData")},e.prototype.testAlert=function(e){alert(e)},e.prototype.ngOnInit=function(){},e.prototype.ngAfterViewInit=function(){this.readColorDataFromServer(),this.ReadKeyAssignDataFromServer(),this.setPageIndex(1),this.i18nClickExcute(),this.MacroManager.createMacroClass(""),this.MacroManager.createClassMacroFile("")},e.prototype.HyperLinkGO=function(e){switch(console.log("Enter_customHyper_Link",ipcRenderer.cp,ipcRenderer,ipcRenderer.remote),e){case 0:ipcRenderer.send("customHyper_Link","https://www.facebook.com/Kemovetech/");break;case 1:ipcRenderer.send("customHyper_Link","https://www.instagram.com/kemovedirect/");break;case 2:ipcRenderer.send("customHyper_Link","mailto:market@kmovetech.com");break;case 3:ipcRenderer.send("customHyper_Link","https://www.kemovebbs.com");break;case 4:ipcRenderer.send("customHyper_Link","https://kmovetech.com");break;case 5:ipcRenderer.send("customHyper_Link","https://twitter.com/KemoveD");break;case 6:ipcRenderer.send("customHyper_Link","https://wx.qq.com/");break;case 7:ipcRenderer.send("customHyper_Link","https://www.weibo.com/")}},e.prototype.i18nClickExcute=function(){this.i18nManager.update(),this.onSystemSetting=!1,this.MacroManager.i18nName=this.i18nManager.getTarget().P3.MACROTYPE,this.i18nManager.recovery[1]&&(this.i18nManager.recovery[0]=!1,this.i18nManager.recovery[1]=!1,this.KeyBoardManager.clearAllKeyboardData(this.i18nManager.getTarget().P2.HARDWARECONFIGURATION)),this.KeyBoardManager.i18nChangeName(this.i18nManager.getTarget().P2.HARDWARECONFIGURATION),this.Led.mode_name=this.i18nManager.getTarget().LED_MODE_NAME},e.prototype.i18nSave=function(){this.i18nClickExcute(),this.KeyBoardManager.getTarget().checkKeyAssignHasData("from_i18nSave"),this.setDBDataToServer("APPConfig")},e.prototype.switch_current_script=function(e){this.MacroManager.getClass().currentChooseMacro=e,console.log("switch_current_script進入",this.MacroManager.getClass()),this.MacroManager.tempMacroContent=this.MacroManager.getClass().getTarget(),this.MacroManager.nowEditName=this.MacroManager.tempMacroContent.name},e.prototype.prohibit_btn_KB1Data=function(e){this.KeyBoardManager.getTarget().set_prohibit(e),this.setDBDataToServer("KeyAssign")},e.prototype.readColorDataFromServer=function(){var e=this,t={Type:funcVar.FuncType.System,Func:funcVar.FuncName.ReadSyncEffectDB};console.log("APP_SyncEffectDB"),this.protocol.RunSetFunction(t).then(function(t){if(console.log("SyncEffectDB:",t),void 0!==t){var o=JSON.parse(JSON.stringify(t));console.log("SyncEffectIndex:","SyncEffect:",o),e.Led.recordModeArr=o,e.RGBMode=e.Led.getTarget()}})},e.prototype.NullThenUpdateValue=function(e,t,o,r){e[t]||(e[t]=o),e[t]>r&&(e[t]=r)},e.prototype.ReadKeyAssignDataFromServer=function(){var e=this,t={iDevice:0},o={Type:funcVar.FuncType.Device,Func:funcVar.FuncName.ReadAllDB,Param:t};this.protocol.RunSetFunction(o).then(function(t){if(void 0!==t){var o=JSON.parse(JSON.stringify(t));if(console.log("APP_ReadALLDB:",o),console.log("KeyAssignData:",o.SWprofiles),void 0!==o.SWprofiles){e.KeyBoardManager.radioOptions=o.SWprofiles.radioOptions,e.KeyBoardManager.radioOptionsFrequency=o.SWprofiles.radioOptionsFrequency;var r=o.SWprofiles.KeyBoardArray;console.log("AllDB_KeyAssignData:",r);for(var a=e.KeyBoardManager.KeyBoardArray,n=0;n<r.length;n++)a.length<r.length&&a.create_KeyBoard(),a[n].ImportClassData(r[n])}if(console.log("MacroData:",o.MacroObj),void 0!==o.MacroObj){for(var s=o.MacroObj,i=0;i<e.MacroManager.macroClassItem.length;i++)e.MacroManager.deleteMacroClass();for(var i=0;i<s.length;i++){e.MacroManager.createMacroClass(s[i].className);for(var c=0;c<s[i].MacroFiletItem.length;c++)console.log("MacroFiletItem:",s[i].MacroFiletItem[c]),e.MacroManager.macroClassItem[i].ReadFileCreateData(s[i].MacroFiletItem[c])}}if(void 0!==o.CustomObj){console.log("AllDB.CustomObj:",o.CustomObj),console.log("this.LCFM.LedChainFrames:",e.LCFM.LedChainFrames);for(var l=0;l<e.LCFM.LedChainFrames.length;l++)e.LCFM.delete_item();for(var l=0;l<o.CustomObj.length;l++)e.LCFM.ReadClassCreateData(o.CustomObj[l])}void 0!==o.SyncProgObj&&(console.log("AllDB.CustomObj:",o.SyncProgObj),e.AssociateManager.AssociateArr=o.SyncProgObj),void 0!==o.APPConfigObj&&(console.log("AllDB.APPConfigObj:",o.APPConfigObj),console.log("this.i18nManager:",e.i18nManager),e.i18nManager.autoStart=o.APPConfigObj.autoStart,e.i18nManager.chooseLangindex=o.APPConfigObj.chooseLangindex,e.i18nManager.onUsingLangindex=o.APPConfigObj.onUsingLangindex,e.i18nManager.recovery=o.APPConfigObj.recovery,e.i18nClickExcute())}})},e.prototype.setCustomPreviewToServer=function(e){console.log("One CustomData:",this.LCFM.LedChainFrames[this.LCFM.currentChooseIndex]);var t={iDevice:0,CustomDataObj:this.LCFM.LedChainFrames[this.LCFM.currentChooseIndex]},o={Type:funcVar.FuncType.System,Func:funcVar.FuncName.SetLEDPreview,Param:t};this.protocol.RunSetFunction(o).then(function(e){})},e.prototype.setPreviewOnOffToServer=function(){var e={iMode:1,bStart:2},t={Type:funcVar.FuncType.System,Func:funcVar.FuncName.SwitchSyncLEDPreview,Param:e};this.protocol.RunSetFunction(t).then(function(e){})},e.prototype.setDBDataToServer=function(e){var t={iDevice:0};switch(e){case"KeyAssign":var o={KeyBoardArray:this.KeyBoardManager.KeyBoardArray,radioOptions:this.KeyBoardManager.radioOptions,radioOptionsFrequency:this.KeyBoardManager.radioOptionsFrequency};t.SWprofiles=o,console.log("SWprofiles:",t),this.KeyBoardManager.getTarget().checkKeyAssignHasData("from_KeyAssign");break;case"AssociateProg":var r=this.AssociateManager.AssociateArr;t.ObjSyncData=r,console.log("this.AssociateManager_Arr:",t);break;case"MacroManager":var a=this.MacroManager.macroClassItem;t.MacroObj=a,console.log("this.MacroManager macroClassItem:",t);break;case"CustomData":var n=JSON.parse(JSON.stringify(this.LCFM.LedChainFrames));t.CustomDataObj=n,console.log("this.LCFM.LedChainFrames:",t);break;case"APPConfig":this.i18nManager.update();var s=JSON.parse(JSON.stringify(this.i18nManager));t.APPConfig=s,console.log("this.I18nManager:",s)}var i={Type:funcVar.FuncType.Device,Func:funcVar.FuncName.SetAllDB,Param:t};this.protocol.RunSetFunction(i).then(function(e){})},e.prototype.setDeviceToServer=function(e){var t=this;console.log("setDeviceToServer:",e),this.onLoading=!0;var o,r={iDevice:0};switch(this.CurrentPageIndex){case 2:case 3:case 7:var a=this.KeyBoardManager.KeyBoardArray,n=this.KeyBoardManager.currentChooseKeyBoard;r.KeyAssignment=a,r.Profile=n,console.log("SWprofiles:",r),o=funcVar.FuncName.SetKeyMatrix;break;case 4:var s=this.AssociateManager.AssociateArr;r.ObjSyncData=s,o=funcVar.FuncName.SetSyncProgram}2==this.CurrentPageIndex?this.setDBDataToServer("KeyAssign"):3==this.CurrentPageIndex&&this.setDBDataToServer("MacroManager");var i={Type:funcVar.FuncType.Device,Func:o,Param:r};this.protocol.RunSetFunction(i).then(function(e){if(t.onLoading=!1,console.log("setDeviceToServer_this.onLoading:",t.onLoading),2==t.CurrentPageIndex){console.log("SetCustomLEDProfile:1");var o=!1,a=JSON.parse(JSON.stringify(r.KeyAssignment));console.log("SWprofiles:",a);for(var n=t.KeyBoardManager.currentChooseKeyBoard,s=0;s<a[n].fiveDefaultLedCode.length;s++)if(0!=a[n].fiveDefaultLedCode[s].projectCode){o=!0;break}if(o){console.log("SetCustomLEDProfile:2");var i={iMode:0,bStart:0},c={Type:funcVar.FuncType.System,Func:funcVar.FuncName.SwitchLEDEffect,Param:i};t.protocol.RunSetFunction(c).then(function(e){var r={iDevice:0,Profile:n,KeyAssignment:a,bProfileCustom:o},s={Type:funcVar.FuncType.Device,Func:funcVar.FuncName.SetCustomLEDProfile,Param:r};t.protocol.RunSetFunction(s).then(function(e){t.onLoading=!1})})}}})},e.prototype.setColorDataToServer=function(e){if(void 0===e&&(e="未設置"),console.log("setColorDataToServer_"+e),"setModeFrameRange"!=e&&"range"!=e){var t=this.RGBMode;this.NullThenUpdateValue(t,"opacity",0,100),this.NullThenUpdateValue(t,"speed",1,10),this.NullThenUpdateValue(t,"bandwidth",50,500),this.NullThenUpdateValue(t,"angle",0,360),this.NullThenUpdateValue(t,"number",1,10),this.NullThenUpdateValue(t,"fire",0,10),this.NullThenUpdateValue(t,"gap",0,500),this.NullThenUpdateValue(t,"randomspeed",0,5),this.NullThenUpdateValue(t,"time",.5,3),this.NullThenUpdateValue(t,"radius",0,300),this.NullThenUpdateValue(t,"amplitude",200,8e3),this.NullThenUpdateValue(t,"color_quantity",0,20)}var o=this.Led.recordModeArr,r={EffectLibrary:o};console.log("SetSyncLEDData:"+e,r,this.RGBMode.opacity);var a={Type:funcVar.FuncType.System,Func:funcVar.FuncName.SetSyncLEDData,Param:r};this.protocol.RunSetFunction(a).then(function(e){})},e.prototype.setProfileIDToServer=function(){var e={iDevice:0,Profile:this.KeyBoardManager.currentChooseKeyBoard};console.log("ProfileID:",this.KeyBoardManager.currentChooseKeyBoard);var t={Type:funcVar.FuncType.Device,Func:funcVar.FuncName.SetProfile,Param:e};this.protocol.RunSetFunction(t).then(function(e){})},e.prototype.setPageIndex=function(e){var t=this;switch(this.onEqipBtn=!1,console.log("setPageIndex",e),1!=e&&(console.log("removeP1EventListener"),document.removeEventListener("mousedown",this.BoxSelectFnArrP1[0]),document.removeEventListener("mousemove",this.BoxSelectFnArrP1[1]),document.removeEventListener("mouseup",this.BoxSelectFnArrP1[2]),this.EffectCenter.selectEffectCenter=!1,this.Led.BSApage1.EventCanBoxSelect=!1),7!=e&&(console.log("removeP7EventListener"),document.removeEventListener("mousedown",this.BoxSelectFnArrP7[0]),document.removeEventListener("mousemove",this.BoxSelectFnArrP7[1]),document.removeEventListener("mouseup",this.BoxSelectFnArrP7[2])),4!=e&&(console.log("removeP3EventListener"),document.removeEventListener("keydown",this.RS.RSEventArr[0]),document.removeEventListener("keyup",this.RS.RSEventArr[1]),document.removeEventListener("mousedown",this.RS.RSEventArr[2]),document.removeEventListener("mouseup",this.RS.RSEventArr[3])),this.ShowPrompt=!1,e){case 0:this.CurrentPageIndex=0;break;case 7:if(7==this.CurrentPageIndex)return;this.CurrentPageIndex=e,this.pageIconSet=[!0,!0,!0,!0];var o=SharesFunction_1.count_boolean(this.pageIconSet,!0),r=document.getElementById("CRUD");r.style.height=2.5*o+"vh",this.changeDetectorRef.detectChanges(),this.page7_custom_box_selectionJs(),this.page7_custom_square_color_picker(),this.LCFM.refreshRange(),this.setCustomPreviewToServer("setPageIndex");break;case 1:if(1==this.CurrentPageIndex)return;this.CurrentPageIndex=e,this.changeDetectorRef.detectChanges(),this.pageIconSet=[!0,!0,!0,!0];var o=SharesFunction_1.count_boolean(this.pageIconSet,!0),r=document.getElementById("CRUD");r.style.height=2.5*o+"vh",this.page1_custom_box_selectionJs(),this.page1_custom_square_color_picker(),this.EffectCenter.App=this,this.EffectCenter.addCenterEvent("APModeKBUI"),this.sendCoordnatesToServer(),this.RGBMode=this.Led.getTarget();break;case 2:if(2==this.CurrentPageIndex)return;this.CurrentPageIndex=e,this.changeDetectorRef.detectChanges();var a=document.getElementById("main-app");a.addEventListener("mousedown",function(e){console.log("mainapp_mousedown=event.targetid=log: ",e),console.dir("mainapp_mousedown=event.targetiddir: ",e),"MainFrame"==e.target.id&&(t.ShowPrompt=!1)}),this.pageIconSet=[!1,!0,!0,!1];var o=SharesFunction_1.count_boolean(this.pageIconSet,!0),r=document.getElementById("CRUD");r.style.height=2.5*o+"vh";var n=this.elementRef.nativeElement.querySelectorAll(".KeyAssignUIStyle");this.KeyBoardStyle.applyStyles(n);for(var s,i=function(e){var o=n[e];s=e.toString(),o.setAttribute("data-index",s),o.addEventListener("mousedown",function(o){t.KeyBoardManager.keyAssignPrompt(event),t.ShowPrompt=!0,t.KeyBoardManager.getTarget().recordAssignBtnIndex=e})},c=0;c<n.length;c++)i(c);this.KeyBoardManager.getTarget().checkKeyAssignHasData("from_setpage");break;case 3:if(3==this.CurrentPageIndex)return;this.CurrentPageIndex=e,this.changeDetectorRef.detectChanges(),this.pageIconSet=[!0,!1,!1,!0];var o=SharesFunction_1.count_boolean(this.pageIconSet,!0),r=document.getElementById("CRUD");r.style.height=2.5*o+"vh",this.RS.RSEventArr[0]=function(e){1==t.onRecord&&(console.log("進入keydown",e.keyCode),t.eventRecordingKeep(e.keyCode))},this.RS.RSEventArr[1]=function(e){1==t.onRecord&&(console.log("進入keyup",e.keyCode),44!=e.keyCode&&t.eventRecordingbreak(e.keyCode))},this.RS.RSEventArr[2]=function(e){if(console.log("進入mousedown"),1==t.onRecord&&"IconRecord"!=e.target.id){var o=9999-e.button;t.addMacroRadioOptions(o,1),t.startTime=(new Date).getTime()}},this.RS.RSEventArr[3]=function(e){if(console.log("進入mouseup"),1==t.onRecord&&"IconRecord"!=e.target.id){var o=9999-e.button;t.addMacroRadioOptions(o,0),t.startTime=(new Date).getTime()}},document.addEventListener("keydown",this.RS.RSEventArr[0]),document.addEventListener("keyup",this.RS.RSEventArr[1]),document.addEventListener("mousedown",this.RS.RSEventArr[2]),document.addEventListener("mouseup",this.RS.RSEventArr[3]);break;case 4:if(4==this.CurrentPageIndex)return;this.CurrentPageIndex=e,this.changeDetectorRef.detectChanges(),this.pageIconSet=[!1,!1,!0,!0];var o=SharesFunction_1.count_boolean(this.pageIconSet,!0),r=document.getElementById("CRUD");r.style.height=2.5*o+"vh"}},e.prototype.setSelectionStyle=function(e){return this.Led.AllBlockColor[e].border&&this.Led.BSApage1.EventCanBoxSelect?"1px solid #ff0":"none"},e.prototype.sendCoordnatesToServer=function(){var e=document.getElementsByClassName("RGBColorBlockStyle");console.log("sendCoordnatesToServer長度",e.length,this.Led.ledcoordinates),this.Led.ledcoordinates=[];for(var t=0;t<e.length;t++){var o=e[t];o.offsetLeft,o.offsetLeft+o.clientWidth,o.offsetTop,o.offsetTop+o.clientHeight;this.Led.ledcoordinates.push({x1:o.offsetLeft,x2:o.offsetLeft+o.clientWidth,y1:o.offsetTop,y2:o.offsetTop+o.clientHeight})}var r={DeviceBtnAxis:this.Led.ledcoordinates},a={Type:funcVar.FuncType.System,Func:funcVar.FuncName.SetDeviceBtnAxis,Param:r};this.protocol.RunSetFunction(a).then(function(e){console.log("SetDeviceBtnAxis Finish")})},e.prototype.setSelectionKeyLed=function(){var e=this.LCFM.getIndexClassName(this.recordCustomLedindex);0==this.on_AdvancedFive?(this.ShowAdvancedList=!1,this.KeyBoardManager.getTarget().setRecordLed(e.projectName,e.projectCode),this.setDBDataToServer("KeyAssign")):(this.ShowAdvancedList=!1,this.KeyBoardManager.getTarget().set_FiveLed(e.projectName,e.projectCode),this.setDBDataToServer("KeyAssign"))},e.prototype.setSelectionKeyData=function(e){console.log("setSelectionKeyData進入",e.target.dataset.index,e),this.KeyBoardManager.getTarget().set_assign_Text_Value(e.target.dataset.index,e.target.value,1,0),this.setDBDataToServer("KeyAssign")},e.prototype.setRBtnFnKeyData=function(e){console.log("setRBtnFnKeyData進入=>",e.target.dataset.index+"____",e),this.KeyBoardManager.getTarget().checkFnSetOnlyData(e.target.dataset.index),this.KeyBoardManager.getTarget().set_assign_Text_Value(e.target.dataset.index,e.target.id,1,0),this.setDBDataToServer("KeyAssign")},e.prototype.setSelectionKeyCombination=function(){console.log("setSelectionKeyCombination",this.KeyBoardManager.combination);for(var e="",t=0;t<this.KeyBoardManager.combination.length;t++){var o=this.KeyBoardManager.combination[t];""==e&&o.check?e+=o.name:""!=e&&o.check&&(e+="+"+o.name)}this.KeyBoardManager.combination.map(function(e){return e.check});e+=""!=e?"+"+this.KeyBoardManager.combinationkey:this.KeyBoardManager.combinationkey,this.KeyBoardManager.getTarget().set_assign_Text_Value("KCombination",e,65536,0),this.setDBDataToServer("KeyAssign")},e.prototype.combinationkey=function(e){this.KeyBoardManager.combinationkey=this.EM.getkeyCodeTxt(e)},e.prototype.RGBEyeClose=function(e){this.Led.recordModeArr[e].check=!this.Led.recordModeArr[e].check,this.setColorDataToServer("RGBEyeClose")},e.prototype.setSelectionKeyMacro=function(){if(this.MacroManager.getClass().hasFile()){console.log("setSelectionKeyMacro");var e;switch(this.KeyBoardManager.radioOptions){case 65534:e=this.KeyBoardManager.radioOptionsFrequency;break;case 65535:e=65535;break;case 65536:e=65536}var t=this.MacroManager.getClass().getTarget();this.KeyBoardManager.getTarget().set_assign_Text_Value("KMacro",t.name,e,t.IndexCode),this.setDBDataToServer("KeyAssign")}},e.prototype.customMouseEventClickLog=function(e){console.log("(event.target): ",e.target),console.log("(event.target): ",e.target.id);Math.round(window.innerWidth/100),Math.round(window.innerHeight/100)},e.prototype.page1_custom_box_selectionJs=function(){var e=this;this.Led.BSApage1.setSelectContainer("EventCanBoxSelectRange");var t=this.elementRef.nativeElement.querySelectorAll(".RGBColorBlockStyle");this.KeyBoardStyle.applyStyles(t),this.BoxSelectFnArrP1[0]=function(t){e.Led.BSApage1.mousedown(t)},this.BoxSelectFnArrP1[1]=function(t){e.Led.BSApage1.mousemove(t)},this.BoxSelectFnArrP1[2]=function(t){"Finish"==e.Led.BSApage1.mouseup(t)&&(e.Led.setModeFrameRange(),console.log("BoxSelectionArea.mouseup",e.Led.BSApage1),e.setColorDataToServer("setModeFrameRange"))},this.Led.BSApage1.selectContainer.addEventListener("mousedown",this.BoxSelectFnArrP1[0]),document.addEventListener("mousemove",this.BoxSelectFnArrP1[1]),document.addEventListener("mouseup",this.BoxSelectFnArrP1[2])},e.prototype.page7_custom_box_selectionJs=function(){var e=this;this.LCFM.BSApage7.setSelectContainer("EventCanBoxSelectRange");var t=this.elementRef.nativeElement.querySelectorAll(".RGBColorBlockP7");console.log("setPageIndex新增P7事件",t),this.KeyBoardStyle.applyStyles(t),this.LCFM.BSApage7.EventCanBoxSelect=!0,console.log("page7_custom_box_selectionJs",this.LCFM.BSApage7.searchTargetName),this.BoxSelectFnArrP7[0]=function(t){e.LCFM.performingCustomLED||0==e.LCFM.check_length("F")&&0==e.LCFM.check_length("C")||e.LCFM.BSApage7.mousedown(t)},this.BoxSelectFnArrP7[1]=function(t){e.LCFM.BSApage7.mousemove(t)},this.BoxSelectFnArrP7[2]=function(t){"Finish"==e.LCFM.BSApage7.mouseup(t)&&(e.LCFM.checkisAllTrueChangeArray(),console.log("BoxSelectionArea.mouseup",e.LCFM.BSApage7),e.setDBDataToServer("CustomData"))},this.LCFM.BSApage7.selectContainer.addEventListener("mousedown",this.BoxSelectFnArrP7[0]),document.addEventListener("mousemove",this.BoxSelectFnArrP7[1]),document.addEventListener("mouseup",this.BoxSelectFnArrP7[2])},e.prototype.showCustomTestDataWindows=function(e){var t=document.getElementById("conslogtestText");t.innerText=JSON.stringify(e).replace(/,/g,",\n").replace(/{/g,"{\n").replace(/}/g,"\n}")},e.prototype.showlog=function(e){console.log(e)},e.prototype.switchEffectMode=function(e){this.Led.switchEffectMode(e),this.RGBMode=this.Led.getTarget(),this.Led.updateframe_selection_range(),this.setColorDataToServer("switchEffectMode"),this.switchEffectUI=!1,this.EffectCenter.selectEffectCenter=!1},e.prototype.OpenLeftDropDownListUI=function(e,t){if(0==e.button&&this.Led.currentModeIndex==t){var o=document.getElementById("LightModeList");this.switchEffectUI=!0,o.style.left=e.clientX-10+"px",o.style.top=e.clientY-10+"px"}},e.prototype.page1_custom_square_color_picker=function(){var e=this,t=document.getElementById("LedColorPickingArea");this.colorPickerFnArrP1[0]=function(t){"Fire"!=e.RGBMode.name&&(e.LedColor.mousedown(t),e.updateColorBlockP1(),e.colorPickerFnArrP1[1]=function(t){e.LedColor.mousemove(t),e.updateColorBlockP1(),e.showCustomTestDataWindows(e.LedColor)},document.addEventListener("mousemove",e.colorPickerFnArrP1[1]),document.addEventListener("mouseup",function(){document.removeEventListener("mousemove",e.colorPickerFnArrP1[1])}))},t.addEventListener("mousedown",this.colorPickerFnArrP1[0])},e.prototype.page7_custom_square_color_picker=function(){var e=this,t=document.getElementById("customLedColorPickingArea");this.colorPickerFnArrP7[0]=function(t){"Fire"!=e.RGBMode.name&&(e.customLedColor.mousedown(t),e.updateColorBlockP7(),e.colorPickerFnArrP7[1]=function(t){e.customLedColor.mousemove(t),e.updateColorBlockP7(),e.showCustomTestDataWindows(e.LedColor)},document.addEventListener("mousemove",e.colorPickerFnArrP7[1]),document.addEventListener("mouseup",function(){document.removeEventListener("mousemove",e.colorPickerFnArrP7[1])}))},t.addEventListener("mousedown",this.colorPickerFnArrP7[0])},e.prototype.updateColorBlockP1=function(){this.Led.getTarget().color[this.LedColor.currentRecordIndex]=this.LedColor.Hex,this.setColorDataToServer("byP1")},e.prototype.updateColorBlockP7=function(){0!=this.LCFM.check_length("C")&&(this.LCFM.getClass().setCurrentColor(this.customLedColor.getPreDefineColor()),this.LCFM.color_Auto_Switch(),this.setDBDataToServer("CustomData"))},e.prototype.sevenColorExclusiveFn=function(e){this.LCFM.getClass().getTarget().color=this.customLedColor.backGroundColorRgbToHex(e.target.style.backgroundColor),this.LCFM.color_Auto_Switch()},e.prototype.LEDModeSelect=function(e,t){console.log("LEDModeSelect: ",e,t),this.Led.currentModeIndex=t,this.RGBMode=this.Led.recordModeArr[t],"Fire"==this.RGBMode.name&&(this.LedColor.currentRecordIndex=0),this.Led.updateframe_selection_range()},e.prototype.LEDModeEyeStatus=function(e){var t=[2,3];return this.Led.currentModeIndex==e&&(t=[0,1]),this.Led.recordModeArr[e].check?this.ImgPath.LedModeCanSee[t[1]]:this.ImgPath.LedModeCanSee[t[0]]},e.prototype.project_select=function(e,t){console.log("project_select: ",e,t),this.KeyBoardManager.currentChooseKeyBoard=t,this.setProfileIDToServer(),this.KeyBoardManager.getTarget().checkKeyAssignHasData("from_project_select");
},e.prototype.ImportProfile=function(){var e=this;this.onAppImportExport=!0;var t="";switch(this.CurrentPageIndex){case 1:t="APMode";break;case 2:t="KeyAssign";break;case 3:t="Macro";break;case 4:t="exe";break;case 7:t="Advanced"}return 4==this.CurrentPageIndex?void dialog.showOpenDialog(null,{defaultPath:"",filters:[{name:t+" File",extensions:[t]}]},function(o){if(console.log("showOpenDialog:",t,o),void 0!=o){console.log("讀取路徑fns",o[0]);var r=o[0].lastIndexOf("\\"),a=o[0].lastIndexOf("."),n=o[0].substring(r+1),s=o[0].substring(r+1,a);console.log("程序關聯原字串"+o[0]),console.log("\\跟.位置="+r,a,"結果=",s,"exeName=",n);var i=e.AssociateManager.Order("Add");i.associatePath=n,i.name=s,e.setDBDataToServer("AssociateProg"),e.onAppImportExport=!1,e.changeDetectorRef.detectChanges()}else console.log("Dialog_Import_undefined:",t,o),e.onAppImportExport=!1,e.changeDetectorRef.detectChanges()}):void dialog.showOpenDialog(null,{defaultPath:"",filters:[{name:t+" File",extensions:[t]}]},function(o){if(console.log("showOpenDialog:",t,o),void 0!=o){console.log("讀取路徑fns",o[0]);var r=o[0].lastIndexOf("\\"),a=o[0].lastIndexOf("."),n=(o[0].substring(r+1),o[0].substring(r+1,a));console.log("anyString="+r,a,"結果=",n),console.log("原字串"+o[0]);var s={Path:o[0]},i={Type:funcVar.FuncType.System,Func:funcVar.FuncName.ImportProfile,Param:s};e.protocol.RunSetFunction(i).then(function(t){if(console.log("ImportProfile:",t),e.onAppImportExport=!1,e.changeDetectorRef.detectChanges(),null!=t)switch(e.CurrentPageIndex){case 1:void 0!=t.pagedata.angle&&(e.Led.ImportCreateLedData(t.pagedata),e.setColorDataToServer("P1"));break;case 2:if(void 0!=t.pagedata.assignedKeyboardKeys){var o=e.LCFM.LedChainFrames,r=e.MacroManager.getAllMacroFileData();e.KeyBoardManager.getTarget().ImportClassData(t.pagedata),e.KeyBoardManager.getTarget().clearLostLCFM(o),e.KeyBoardManager.getTarget().clearLostMacro(r),e.setDBDataToServer("KeyAssign")}break;case 3:void 0!=t.pagedata.currentlySelectiedPosition&&(console.log('data["pagedata"]["currentlySelectiedPosition"]存在',t.pagedata.currentlySelectiedPosition),t.pagedata.name=e.MacroManager.createNotRepeatName(n),e.MacroManager.getClass().ImportFileCreateData(t.pagedata)),e.setDBDataToServer("MacroManager");break;case 7:t.pagedata.projectName=e.LCFM.createNotRepeatClassName(n),e.LCFM.ImportClassCreateData(t.pagedata),e.setDBDataToServer("CustomData")}else alert("檔案有誤 請重新輸入")})}else console.log("Dialog_Import_undefined:",t,o),e.onAppImportExport=!1,e.changeDetectorRef.detectChanges()})},e.prototype.ExportProfile=function(){var e=this,t="",o="";switch(this.onAppImportExport=!0,this.CurrentPageIndex){case 1:t="APMode",o=this.Led.getTarget().name;break;case 2:t="KeyAssign",o=this.KeyBoardManager.getTarget().projectName;break;case 3:t="Macro",o=this.MacroManager.getClass().getTarget().name;break;case 7:t="Advanced",o=this.LCFM.getClass().projectName}dialog.showSaveDialog(null,{defaultPath:o,filters:[{name:t+" File",extensions:[t]}]},function(o){if(console.log("showSaveDialog:",name,o),void 0!=o){e.onAppImportExport=!1,e.changeDetectorRef.detectChanges();var r;switch(e.CurrentPageIndex){case 1:r={pagedata:e.RGBMode};break;case 2:r={pagedata:e.KeyBoardManager.getTarget()};break;case 3:r={pagedata:e.MacroManager.getClass().getTarget()};break;case 7:r={pagedata:e.LCFM.getClass()}}var a={Path:o,Data:r},n={Type:funcVar.FuncType.System,Func:funcVar.FuncName.ExportProfile,Param:a};console.log("ExportProfile:",r),e.protocol.RunSetFunction(n).then(function(e){})}else console.log("Dialog_Export_undefined::",t,o),e.onAppImportExport=!1,e.changeDetectorRef.detectChanges()})},e.prototype.newHtmlDomElement=function(){switch(console.log("newHtmlDomElement",this.CurrentPageIndex),this.CurrentPageIndex){case 1:this.Led.addNewChoose(),this.setColorDataToServer("addNewChoose");break;case 2:break;case 3:this.MacroManager.createMacroClass(this.i18nManager.getTarget().P3.MACROTYPE),this.setDBDataToServer("MacroManager");break;case 4:this.AssociateManager.Order("Add");break;case 7:this.LCFM.addItem(this.i18nManager.getTarget().P7.DEFAULT)}},e.prototype.deleteHtmlDomElement=function(){switch(console.log("deleteHtmlDomElement",this.CurrentPageIndex),this.CurrentPageIndex){case 1:this.Led.deleteChoose(),this.RGBMode=this.Led.getTarget(),this.Led.updateframe_selection_range(),this.setColorDataToServer("deleteHtmlDomElement");break;case 2:break;case 3:for(var e=this.MacroManager.getClass(),t=0;t<e.MacroFiletItem.length;t++){var o=e.MacroFiletItem[t].name;this.KeyBoardManager.clearRecordMacroData(o)}this.MacroManager.deleteMacroClass();break;case 4:this.AssociateManager.Order("Delete");break;case 7:this.LCFM.LedChainFrames.length>1&&(this.KeyBoardManager.clearAllAssignRecordLed(this.LCFM.getClass().projectName),this.LCFM.delete_item())}},e.prototype.checkLimit=function(){this.on_AdvancedFive=!1,this.KeyBoardManager.getTarget().countTotalAssign()>=11?this.alertMessageBool=!0:this.ShowAdvancedList=!0},e.prototype.switchMacroClass=function(e){this.MacroManager.currentChooseMacroClass=e,this.MacroManager.getClass().hasFile()?(this.MacroManager.tempMacroContent=this.MacroManager.getClass().getTarget(),this.MacroManager.updeteEditName()):this.MacroManager.tempMacroContent=new MacroModule_1.MacroScriptContent},e.prototype.MacroFileNameChange=function(e){console.log("event="+e.target.value);var t=e.target.value.replace(/[^\a-\z\A-\Z^0-9\u4E00-\u9FA5]/g,"");if(this.MacroManager.getClass().getTarget().name!=t){var o=this.MacroManager.createNotRepeatName(t),r=this.MacroManager.getClass().getTarget().name;console.log("MacroFileNameChange="+o,r),this.KeyBoardManager.ChangeAllLookingforMacroName(o,r),this.MacroManager.getClass().getTarget().name=o,this.MacroManager.updeteEditName(),this.setDBDataToServer("MacroManager")}},e.prototype.MacroEditMsFn=function(e){console.log("MacroEditMsFn="+e)},e.prototype.MacroEditkeyCodeFn=function(e){console.log("MacroEditkeyCodeFn="+e.keyCode)},e.prototype.MacroCSNameChange=function(e){console.log("event="+e.target.value);var t=e.target.value.replace(/[^\a-\z\A-\Z^0-9\u4E00-\u9FA5]/g,""),o=this.MacroManager.getClass().className;if(o!=t){var r=this.MacroManager.createNotRepeatClassName(t);console.log("MacroFileNameChange="+r,o),this.MacroManager.getClass().className=r,this.MacroManager.updeteEditClassName(),this.setDBDataToServer("MacroManager")}},e.prototype.LCFMFileNameChange=function(e){console.log("projectName",this.LCFM.getClass().projectName),console.log("event",e);var t=e.target.value.replace(/[^\a-\z\A-\Z^0-9\u4E00-\u9FA5]/g,""),o=this.LCFM.createNotRepeatClassName(t),r=this.LCFM.getClass().projectName;console.log("MacroFileNameChange="+o,r),r!=t&&(this.LCFM.getClass().projectName=o,this.KeyBoardManager.ChangeAllLookingforLCFMName(o,r),this.LCFM.updeteEditName(),this.setDBDataToServer("CustomData"))},e=__decorate([core_1.Component({selector:"sm-app",templateUrl:"./components/app.component.html",styleUrls:["./components/app.component.css","./components/KeyBoardStyle.css"],providers:[protocol_service_1.protocolService,index_1.dbService,icpEventService_service_1.icpEventService]}),__metadata("design:paramtypes",[protocol_service_1.protocolService,ng2_translate_1.TranslateService,index_1.EmitService,icpEventService_service_1.icpEventService,material_1.MdDialog,index_1.dbService,index_2.GetAppService,index_2.DeviceService,router_1.Router,core_1.ElementRef,core_1.ChangeDetectorRef])],e)}();exports.AppComponent=AppComponent;